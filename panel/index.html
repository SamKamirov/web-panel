<!doctype html>
<html>
  <head>
    <link
      rel="manifest"
      type="application/manifest+json"
      href="app.webmanifest"
    />
    <meta charset="utf-8" />
    <meta http-equiv="refresh" content="10800" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="normalize.css" />
    <link rel="stylesheet" href="style.css" />
    <script>
      const SEVEN = "";
      const MONTH = "";
      const DAY = "";

      fetch("config.json")
        .then((res) => res.json())
        .then((data) => {
          const container = document.querySelector(".unit__title");
          const dateContainer = document.createElement("p");
          dateContainer.className = "date-container";

          const date = data.date;
          dateContainer.textContent = `Данные на ${date}`;

          container.appendChild(dateContainer);
        });
    </script>
  </head>
  <body class="layout">
    <header class="title layout__title"></header>
    <main class="layout__main panel">
      <h1 class="panel__title">Контрольная панель</h1>
      <section class="unit panel__section">
        <h2 class="unit__title">Повторные заявки</h2>
        <a href="./1/1.html">
          <div class="unit__canvas canvas">
            <h3 class="canvas__title canvas__title--rep">За сутки</h3>
            <div class="addresses addresses--day"></div>
          </div>
        </a>
        <a href="./7/7.html">
          <div class="unit__canvas canvas">
            <h3 class="canvas__title canvas__title--rep">За 7 дней</h3>
            <div class="addresses addresses--seven"></div>
          </div>
        </a>
        <a href="./30/30.html">
          <div class="unit__canvas canvas">
            <h3 class="canvas__title canvas__title--rep">За 30 дней</h3>
            <div class="addresses addresses--month"></div>
          </div>
        </a>
      </section>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("./formatted_7.json")
          .then((res) => res.json())
          .then((SEVEN) => {
            const container = document.querySelector(".addresses--seven");
            SEVEN.sort(
              (prev, next) =>
                next.applications.length - prev.applications.length,
            )
              .slice(0, 5)
              .forEach((item) => {
                const block = document.createElement("div");
                block.className = "addresses__wrapper";
                const addressesCountBlock = document.createElement("div");
                addressesCountBlock.className = "addresses__count";
                const addressesAddressBlock = document.createElement("div");
                addressesAddressBlock.className = "addresses__address";
                addressesCountBlock.textContent = item.applications.length;
                addressesAddressBlock.textContent = item.id;
                block.appendChild(addressesCountBlock);
                block.appendChild(addressesAddressBlock);
                container.appendChild(block);
              });
          });

        fetch("./formatted_30.json")
          .then((res) => res.json())
          .then((MONTH) => {
            const container = document.querySelector(".addresses--month");
            MONTH.sort(
              (prev, next) =>
                next.applications.length - prev.applications.length,
            )
              .slice(0, 5)
              .forEach((item) => {
                const block = document.createElement("div");
                block.className = "addresses__wrapper";
                const addressesCountBlock = document.createElement("div");
                addressesCountBlock.className = "addresses__count";
                const addressesAddressBlock = document.createElement("div");
                addressesAddressBlock.className = "addresses__address";
                addressesCountBlock.textContent = item.applications.length;
                addressesAddressBlock.textContent = item.id;
                block.appendChild(addressesCountBlock);
                block.appendChild(addressesAddressBlock);
                container.appendChild(block);
              });
          });

        fetch("./formatted_1.json")
          .then((res) => res.json())
          .then((MONTH) => {
            const container = document.querySelector(".addresses--day");
            MONTH.sort(
              (prev, next) =>
                next.applications.length - prev.applications.length,
            )
              .slice(0, 5)
              .forEach((item) => {
                const block = document.createElement("div");
                block.className = "addresses__wrapper";
                const addressesCountBlock = document.createElement("div");
                addressesCountBlock.className = "addresses__count";
                const addressesAddressBlock = document.createElement("div");
                addressesAddressBlock.className = "addresses__address";
                addressesCountBlock.textContent = item.applications.length;
                addressesAddressBlock.textContent = item.id;
                block.appendChild(addressesCountBlock);
                block.appendChild(addressesAddressBlock);
                container.appendChild(block);
              });
          });
      });
    </script>
  </body>
</html>
